opjq(document).ready(function(a){var b=a('.op_live_editor .op-pagebuilder, .op_page_builder .op-pagebuilder,#toplevel_page_optimizepress a[href$="page=optimizepress-page-builder"],#op-pagebuilder-container a.op-pagebuilder, form.op-bsw-settings a.op-pagebuilder'),c=a("body"),d={width:"98%",height:"98%",padding:0,closeClick:!1,type:"iframe",beforeShow:function(){a.fancybox.showLoading(),a("html").css({overflow:"hidden",height:"100%"}),a(window.parent.document).find(".fancybox-close").css({display:"none"})},afterShow:function(){var b=a(".fancybox-opened").find("iframe").focus().on("load",function(){a.fancybox.hideLoading()});0===b.length&&a.fancybox.hideLoading(),OptimizePress._pageRevisionsActive&&a(document).trigger("pageRevisionsFancyboxOpen")},beforeClose:function(){return OptimizePress.disable_alert||OptimizePress._pageRevisionsActive?void(OptimizePress.disable_alert=!1):confirm(OptimizePress.pb_unload_alert)},afterClose:function(){OptimizePress._pageRevisionsActive&&(OptimizePress._pageRevisionsActive=!1,a("#op-current-iframe").attr("src",""),a("#op-revisions-iframe").attr("src",""),a(document).off("pageRevisionsFancyboxOpen"),a(window).off("resize",OptimizePress._repositionRevisionsPopup)),a("html").css({overflow:"auto"}),a(window.parent.document).find(".fancybox-close").css({display:"block"}),window.location.pathname.indexOf("wp-admin/edit.php")>=0&&window.location.search.indexOf("post_type=page")>=0&&"undefined"!=typeof OptimizePress.reload_page&&OptimizePress.reload_page===!0&&setTimeout(function(){window.location=window.location.href},0)}};b.fancybox(d),"object"==typeof window.OptimizePress&&(window.OptimizePress.fancybox_defaults=d),a("body.widgets-php").find("#available-widgets #widget-list .widget .widget-description").each(function(){a(this).html(a(this).text())}),a.Deferred(function(b){a(b.resolve),a.ready.promise=b.promise}),a.ready.promise().done(function(){if(window.location.hash){var b=window.location.hash.split("--");$tab=a('.op-bsw-grey-panel-tabs a[href="'+b[0]+'"]'),$tab.length>0&&($tab.trigger("click"),2==b.length&&($provider=a(".tab-"+b[0].substring(1)+" .section-"+b[1]+" .op-bsw-grey-panel-header h3 a"),$provider.trigger("click")))}}),OptimizePress._pageRevisionsActive=!1,OptimizePress._repositionRevisionsPopup=function(){var b=a(".fancybox-outer"),c=b.height(),d=b.find("#op-revisions-dialog"),e=d.find("> h1").outerHeight(),f=d.find(".dialog-content"),g=parseInt(f.css("paddingTop"),10)+parseInt(f.css("paddingBottom"),10),h=d.find(".op-revisions-list"),i=f.find(".op-diff-th").outerHeight()+3;revisionsListHeight=h.outerHeight()+parseInt(h.css("marginBottom"),10),d.find(".op-diff").height(c-e-g-revisionsListHeight),d.find(".op-revisions-iframe").height(c-e-g-revisionsListHeight-i)},OptimizePress._initPageRevisions=function(b,d){var e={action:OptimizePress.SN+"-op_ajax_get_page_revisions",page_id:a("#page_id").val()||d.getAttribute("data-post_id")};OptimizePress._pageRevisionsActive=!0,"undefined"!=typeof op_show_loading&&op_show_loading(),a("#op-revisions-dialog").remove(),a.post(OptimizePress.ajaxurl,e,function(d){var e;c.append(d),OptimizePress._renderPageRevisions(b),e=a("#op-current-iframe"),e.attr("src",e.attr("data-src")),op_hide_loading()})},OptimizePress._renderPageRevisions=function(b){a(document).on("pageRevisionsFancyboxOpen",OptimizePress._repositionRevisionsPopup),a(document).on("pageRevisionsFancyboxOpen",function(){a(".op-revisions-iframe").each(function(){a(this).on("load",function(b){var c="op-revisions-iframe"===this.getAttribute("id")?"op-current-iframe":"op-revisions-iframe";a(b.target.contentWindow).on("scroll",function(){a(document.getElementById(c).contentWindow).scrollTop(a(this).scrollTop())})})})}),a(window).on("resize",OptimizePress._repositionRevisionsPopup),a.fancybox(a.extend({},b,{minWidth:a("#op-revisions-dialog").width(),type:"inline",wrapCSS:"fancybox-revisions",href:"#op-revisions-dialog",autoSize:!1,width:"98%",height:"98%"})),OptimizePress.disable_alert=!1},window.op_show_loading=function(){window.op_dont_show_loading||a("#op_overlay").length>0||(window.top.opjq.fancybox?(window.top.opjq.fancybox.showLoading(),c.append('<div id="op_overlay" style="opacity:1;"></div>')):(c.append('<div id="op_loading"></div><div id="op_overlay"></div>'),setTimeout(function(){a("#op_overlay, #op_loading").css("opacity",1)},100)))},window.op_hide_loading=function(){window.op_dont_hide_loading||(window.top.opjq.fancybox&&window.top.opjq.fancybox.hideLoading(),a("#op_overlay, #op_loading").css("opacity",0),setTimeout(function(){a("#op_overlay, #op_loading").remove()},200))},c.on("click","#op-revisions-button",function(a){a.preventDefault(),OptimizePress._initPageRevisions(d,a.target)}),c.on("click",".op-revision-preview",function(b){b.preventDefault();var c=a(this).attr("href");a("#op-revisions-iframe").attr("src",c)}),c.on("change",".op-revisions-radio",function(b){b.preventDefault();var c=a(this).val();a("#op-revisions-dialog").find(".op-revisions-list-item").removeClass("op-revisions-list-item--selected"),a(this).parent().parent().addClass("op-revisions-list-item--selected"),a("#op-revisions-iframe").attr("src",c),a("#op-open-revision-new-tab").css({display:"inline"}).attr("href",c)}),c.on("click",".op-revision-restore",function(b){var c={action:OptimizePress.SN+"-restore-page-revision",postID:a(this).data("postid"),revisionID:a(this).data("revisionid")};b.preventDefault(),OptimizePress.disable_alert=!0,a.post(OptimizePress.ajaxurl,c,function(b){"undefined"!=typeof b.error?alert(b.error):(a.fancybox.close(),"undefined"!=typeof op_show_loading&&op_show_loading(),window.location.reload(!0))},"json")}),c.on("click",".op-disable-all-css, .op-disable-all-js",function(){var b=a(this).attr("data-type"),c=a(this).closest("table.op-disable-compat").find("input[data-type="+b+"]");return"checked"===a(this).attr("checked")?(a(this).attr("checked",!1),c.attr("checked",!1)):(a(this).attr("checked",!0),c.attr("checked",!0)),!1})});